---
title: "ABC253 C - Max - Min Query Pythonè§£ç­”ä¾‹"
emoji: "ğŸ‰"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°", "ç«¶ãƒ—ãƒ­", "cpp", "AtCoder"]
published: true
---

AtCoder Beginner Contest 253 C - Max - Min Queryã‚’Pythonã§è§£ãã¾ã™ã€‚

## å•é¡Œ

å•é¡Œæ–‡ã‚’[AtCoderã®ãƒšãƒ¼ã‚¸](https://atcoder.jp/contests/abc253/tasks/abc253_c)ã‚ˆã‚Šå¼•ç”¨ã—ã¾ã™ã€‚

### å•é¡Œæ–‡

> æ•´æ•°ã®å¤šé‡é›†åˆ$S$ãŒã‚ã‚Šã¾ã™ã€‚ã¯ã˜ã‚$S$ã¯ç©ºã§ã™ã€‚
>
> $Q$å€‹ã®ã‚¯ã‚¨ãƒªãŒä¸ãˆã‚‰ã‚Œã‚‹ã®ã§é †ã«å‡¦ç†ã—ã¦ãã ã•ã„ã€‚
> ã‚¯ã‚¨ãƒªã¯æ¬¡ã®$3$ç¨®é¡ã®ã„ãšã‚Œã‹ã§ã™ã€‚
>
> - `1 x` : $S$ã«$x$ã‚’$1$å€‹è¿½åŠ ã™ã‚‹ã€‚
> - `2 x c` :$S$ã‹ã‚‰$x$ã‚’$\min(c,$ ($S$ã«å«ã¾ã‚Œã‚‹$x$ã®å€‹æ•°$))$å€‹å‰Šé™¤ã™ã‚‹ã€‚
> - `3` : ($S$ã®æœ€å¤§å€¤)âˆ’($S$ã®æœ€å°å€¤)ã‚’å‡ºåŠ›ã™ã‚‹ã€‚ã“ã®ã‚¯ã‚¨ãƒªã‚’å‡¦ç†ã™ã‚‹ã¨ãã€$S$ãŒç©ºã§ãªã„ã“ã¨ãŒä¿è¨¼ã•ã‚Œã‚‹ã€‚

### åˆ¶ç´„

> - $1 \leq Q \leq 2\times 10^5$
> - $0 \leq x \leq 10^9$
> - $1 \leq c \leq Q$
> - `3`ã®ã‚¯ã‚¨ãƒªã‚’å‡¦ç†ã™ã‚‹ã¨ãã€$S$ã¯ç©ºã§ãªã„ã€‚
> - å…¥åŠ›ã¯å…¨ã¦æ•´æ•°

## è§£ç­”ä¾‹

### åº§æ¨™åœ§ç¸® + ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨

ã“ã®å•é¡Œã®æƒ³å®šè§£ã¯é †åºä»˜ãå¤šé‡é›†åˆ(C++ã§ã¯[std::multiset](https://cpprefjp.github.io/reference/set/multiset.html))ã‚’ä½¿ã£ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚
ãŒã€Pythonã«ã¯é †åºä»˜ãå¤šé‡é›†åˆãŒæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ç”¨æ„ã•ã‚Œã¦ã„ãªã„ã®ã§ã€ä»£æ›¿ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

[ãƒ¦ãƒ¼ã‚¶ãƒ¼è§£èª¬](https://atcoder.jp/contests/abc253/editorial/4040)ã§ã¯ã€å¹³æ–¹åˆ†å‰²ã«ã‚ˆã‚‹SortedSetã‚’ç”¨ã„ã‚‹ã‚‚ã®ã€ãƒ’ãƒ¼ãƒ—ã‚’ç”¨ã„ã‚‹ã‚‚ã®ã€BITã‚’ç”¨ã„ã‚‹ã‚‚ã®ãªã©ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã“ã§ã¯åº§æ¨™åœ§ç¸® + ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã‚’ç”¨ã„ã¦è§£ã„ã¦ã¿ã¾ã™ã€‚

### ä½¿ç”¨ã™ã‚‹ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã§ã¯å¤šé‡é›†åˆ$S$ã®å…ƒã®æœ€å¤§å€¤ã¨æœ€å°å€¤ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ã¨ã—ã¾ã™ã€‚
$S$ã®å…ƒã®ãã‚Œãã‚Œã®å€‹æ•°ã¯è¾æ›¸(`defaultdict`)ã§ç®¡ç†ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

å¾“ã£ã¦ã€ã“ã®è§£æ³•ã§ã¯ä»¥ä¸‹ã®3ã¤ã®ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

1. $S$ã®å…ƒã®æœ€å°å€¤ã‚’ç®¡ç†ã™ã‚‹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨
1. $S$ã®å…ƒã®æœ€å¤§å€¤ã‚’ç®¡ç†ã™ã‚‹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨
1. $S$ã®å…ƒã®å€‹æ•°ã‚’ç®¡ç†ã™ã‚‹`defaultdict`

### ä¸‹æº–å‚™ã¨ã‚¯ã‚¨ãƒªå‡¦ç†

ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã«ä¹—ã›ã‚‹è¦ç´ ã‚’å®šç¾©ã—ã¾ã™ã€‚
ã¾ãšã€ã‚¯ã‚¨ãƒªã«ã‚ˆã£ã¦ä¸ãˆã‚‰ã‚Œã‚‹å…¨ã¦ã®$x$ã‚’åº§æ¨™åœ§ç¸®ã—ã€ã€Œå…¨ä½“ã®ä¸­ã§ä½•ç•ªç›®ã«å°ã•ã„ã‹ã€ã‚’æ±‚ã‚ã¦ãŠãã¾ã™(ã“ã‚Œã‚’$i$ã¨è¡¨ã—ã¾ã™)ã€‚
ã“ã†ã—ãŸå¾Œã€ã‚‚ã—é›†åˆ$S$ã«$x$ãŒå­˜åœ¨ã™ã‚‹ãªã‚‰ã°ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã®$i$ç•ªç›®ã®è‘‰ã«$x$ã‚’ä¹—ã›ã¾ã™ã€‚
ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨å…¨ä½“ã®ç©ã‚’å–ã£ãŸã¨ãã€é›†åˆ$S$ã®ä¸­ã®æœ€å°å€¤(ã‚ã‚‹ã„ã¯æœ€å¤§å€¤)ã‚’å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

é›†åˆ$S$ã«$x$ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã¯ã€`defaultdict`ã§ç®¡ç†ã—ã¾ã™ã€‚ã“ã®è¾æ›¸ã‚’$D$ã¨ãŠãã¾ã™ã€‚
ã‚¯ã‚¨ãƒª1ãŒæ¥ãŸã¨ãã¯$D[x]$ã‚’1ã¤å¢—ã‚„ã—ã€ã‚¯ã‚¨ãƒª2ãŒæ¥ãŸã¨ãã¯$\min(c, D[x])$ã‚’$D[x]$ã‹ã‚‰æ¸›ç®—ã—ã¾ã™ã€‚
ã‚‚ã—$D[x]$ãŒ$0$ã«ãªã£ãŸã¨ãã¯ã€é›†åˆ$S$ã‹ã‚‰$x$ãŒç„¡ããªã£ãŸã“ã¨ã«ãªã‚‹ãŸã‚ã€å¯¾å¿œã™ã‚‹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã®è‘‰ã®å€¤ã‚’å˜ä½å…ƒã«æˆ»ã—ã¦ãŠãã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ã“ã®å•é¡Œã‚’$\mathcal{O}(Q\log{Q})$ã§è§£ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

### å®Ÿè£…

ä»¥ä¸Šã®ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã‚’å®Ÿè£…ã—ãŸã®ãŒä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚
ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã®å®Ÿè£…éƒ¨åˆ†ã¯é•·ããªã£ã¦ã—ã¾ã£ãŸã®ã§ã€[æå‡ºã—ãŸã‚³ãƒ¼ãƒ‰](https://atcoder.jp/contests/abc253/submissions/32085418)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

```python:c.py
from typing import List, Tuple, Deque, Set, Dict, TypeVar, Callable, Generic
import sys
import collections
import itertools
import bisect
import math


sys.setrecursionlimit(1000000)
input = sys.stdin.readline


### ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã®å®Ÿè£…(çœç•¥)


def compress(A: List[int]) -> List[int]:
    """åº§æ¨™åœ§ç¸®"""
    X: List[int] = sorted(set(A))
    D: Dict[int, int] = {x: i for i, x in enumerate(X)}
    return list(map(lambda x: D[x], A))


def main():
    Q: int = int(input())
    query: List[List[int]] = [list(map(int, input().split())) for i in range(Q)]

    # ã‚¯ã‚¨ãƒªå…ˆèª­ã¿
    X: List[int] = []
    for q in query:
        if q[0] == 1 or q[0] == 2:
            X.append(q[1])

    # åº§æ¨™åœ§ç¸®
    Y: List[int] = compress(X)
    # xã‹ã‚‰iã¸ã®å¤‰æ›ã®ãŸã‚ã®è¾æ›¸
    x_to_i: Dict[int, int] = {x: y for x, y in zip(X, Y)}

    # é›†åˆSã®å…ƒã®æœ€å¤§å€¤ã‚’ç®¡ç†ã™ã‚‹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨
    seg_max = SegmentTree[int](lambda a, b: max(a, b), lambda: 0, [0] * len(Y))
    # é›†åˆSã®å…ƒã®æœ€å°å€¤ã‚’ç®¡ç†ã™ã‚‹ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨
    seg_min = SegmentTree[int](
        lambda a, b: min(a, b), lambda: 1 << 60, [1 << 60] * len(Y)
    )
    # å¤šé‡é›†åˆSã®å…ƒã®å€‹æ•°ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®è¾æ›¸
    counter = collections.defaultdict(int)

    # ã‚¯ã‚¨ãƒªå‡¦ç†
    for q in query:
        # ã‚¯ã‚¨ãƒª1
        if q[0] == 1:
            t, x = q
            # xãŒå…¨ä½“ã§ä½•ç•ªç›®ã«å°ã•ã„ã‹ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å–å¾—
            i: int = x_to_i[x]
            # é›†åˆSã«xãŒè¿½åŠ ã•ã‚ŒãŸã®ã§ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã‚’æ›´æ–°ã™ã‚‹
            seg_max.set(i, x)
            seg_min.set(i, x)
            # å…ƒã®æ•°ã‚’1å¢—ã‚„ã™
            counter[x] += 1
        # ã‚¯ã‚¨ãƒª2
        elif q[0] == 2:
            t, x, c = q
            # xãŒå…¨ä½“ã§ä½•ç•ªç›®ã«å°ã•ã„ã‹ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å–å¾—
            i: int = x_to_i[x]
            # æŒ‡å®šã•ã‚ŒãŸæ•°ã ã‘å…ƒã®æ•°ã‚’æ¸›ã‚‰ã™
            counter[x] -= min(c, counter[x])

            # é›†åˆSã‹ã‚‰xãŒç„¡ããªã£ãŸã‚‰ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã®è‘‰ã®å€¤ã‚’å˜ä½å…ƒã«æˆ»ã™
            if counter[x] == 0:
                seg_max.set(i, 0)
                seg_min.set(i, 1 << 60)
        # ã‚¯ã‚¨ãƒª3
        else:
            # å„ã‚»ã‚°ãƒ¡ãƒ³ãƒˆæœ¨ã®å…¨ä½“ã®ç©ãŒæœ€å¤§å€¤ã¨æœ€å°å€¤ã‚’è¡¨ã™
            print(seg_max.prod(0, len(Y)) - seg_min.prod(0, len(Y)))


if __name__ == "__main__":
    main()

```

å®Ÿéš›ã®æå‡ºã¯[ã“ã¡ã‚‰](https://atcoder.jp/contests/abc253/submissions/32085418)ã€‚
