---
title: "ABC267 C - Index Ã— A(Continuous ver.) Pythonè§£ç­”ä¾‹"
emoji: "ğŸ”¡"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["ç«¶æŠ€ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°", "ç«¶ãƒ—ãƒ­", "python", "AtCoder"]
published: true
---

AtCoder Beginner Contest ABC267 C - Index Ã— A(Continuous ver.)ã‚’Pythonã§è§£ãã¾ã™ã€‚

## å•é¡Œ

å•é¡Œæ–‡ã‚’[AtCoderã®ãƒšãƒ¼ã‚¸](https://atcoder.jp/contests/abc267/tasks/abc267_c)ã‚ˆã‚Šå¼•ç”¨ã—ã¾ã™ã€‚

> ### å•é¡Œæ–‡
>
> é•·ã•$N$ã®æ•´æ•°åˆ—$A=(A_1,A_2,\dots,A_N)$ãŒä¸ãˆã‚‰ã‚Œã¾ã™ã€‚
>
> é•·ã•$M$ã®$A$ã®é€£ç¶šéƒ¨åˆ†åˆ—$B=(B_1,B_2,\dots,B_M)$ã«å¯¾ã™ã‚‹ã€$\displaystyle \sum_{i=1}^{M} i \times B_i$ã®æœ€å¤§å€¤ã‚’æ±‚ã‚ã¦ãã ã•ã„ã€‚
>
> ### åˆ¶ç´„
>
> - $1 \le M \le N \le 2 \times 10^5$
> - $- 2 \times 10^5 \le A_i \le 2 \times 10^5$
> - å…¥åŠ›ã¯å…¨ã¦æ•´æ•°ã€‚

## è§£ç­”ä¾‹

### æ•°å¼å¤‰å½¢ã¨ç´¯ç©å’Œ

æ„šç›´ã«è§£ãã¨$\mathcal{O}(MN)$ã‹ã‹ã£ã¦ã—ã¾ã†ã®ã§ã€åŠ¹ç‡ã‚ˆãè§£ãæ–¹æ³•ã‚’è€ƒãˆã¾ã™ã€‚

ä»¥ä¸‹ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè£…ã™ã‚‹ã¨ãã«æ··ä¹±ã—ãªã„ã‚ˆã†ã«ã€é…åˆ—ã‚’0-indexedã§è¡¨ã—ã¾ã™ã€‚
ã™ãªã‚ã¡ã€$A = (A_0, A_1, \ldots, A_{N - 1})$ã€$B = (B_0, B_1, \ldots, B_{M - 1})$ã«å¯¾ã—ã¦ã€$\sum^{M - 1}_{i = 0} i \times B_i$ã‚’è€ƒãˆã¾ã™ã€‚

ã¨ã‚Šã‚ãˆãšæ•°å¼ã‚’å¤‰å½¢ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã¾ã™ã€‚ç²¾æ•°åˆ—$B$ã®å®šç¾©ã‚’ã€ã‚ã‚‹æ•´æ•°$k(0 \leq k \leq N - M)$ã‚’ç”¨ã„ã¦ã€$B = (A_k, A_{k + 1}, \ldots, A_{M + k - 1})$ã¨ã—ã¾ã™ã€‚

ã“ã‚Œã‚’ç”¨ã„ã‚‹ã¨ã€æ±‚ã‚ã‚‹è§£ã®å¼ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰å½¢ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

$$
\begin{align*}
\sum^{M - 1}_{i = 0} i \times B_i &= \sum^{M + k - 1}_{i = k} (i - k) \times A_{i} \\
&= \sum^{M + k - 1}_{i = k} (i \times A_{i} - k \times A_{i}) \\
&= \sum^{M + k - 1}_{i = k} i \times A_{i} - k \times \sum^{M + k - 1}_{i = k} A_{i} \\
\end{align*}
$$

ã“ã®å¼å¤‰å½¢ã«ã‚ˆã‚Šã€$\Sigma$ã®ä¸­èº«ãŒ$k$ã«ä¾å­˜ã—ãªããªã‚Šã¾ã—ãŸã€‚å¾“ã£ã¦ã€ä»¥ä¸‹ã®2ã¤ã®ç´¯ç©å’Œã‚’äº‹å‰ã«è¨ˆç®—ã—ã¦ãŠãã“ã¨ã§åŒºé–“å’Œã‚’é«˜é€Ÿã«è¨ˆç®—ã§ãã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

$$
\begin{align*}
C_j &=
\begin{cases}
0 \quad (j = 0) \\
\sum^{j - 1}_{k = 0} A_k \quad (1 \leq j \leq N)
\end{cases} \\
D_j &=
\begin{cases}
0 \quad (j = 0) \\
\sum^{j - 1}_{k = 0} k \times A_k \quad (1 \leq j \leq N)
\end{cases} \\
\end{align*}
$$

ç´¯ç©å’Œã®é…åˆ—$C, D$ã¯é•·ã•ãŒ$N + 1$ã«ãªã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚[^1]

ç´¯ç©å’Œã‚’ç”¨ã„ã‚‹ã¨ã€$\sum^{M + k - 1}_{i = k} A_i = C_{M + k} - C_k$ã€$\sum^{M + k - 1}_{i = k} i \times A_i = D_{M + k} - D_k$ã¨ãªã‚‹ã®ã§ã€æ±‚ã‚ã‚‹è§£ã¯

$$
\begin{align*}
\sum^{M - 1}_{i = 0} i \times B_i &= \sum^{M + k - 1}_{i = k} (i - k) \times A_{i} \\
&= \sum^{M + k - 1}_{i = k} (i \times A_{i} - k \times A_{i}) \\
&= \sum^{M + k - 1}_{i = k} i \times A_{i} - k \times \sum^{M + k - 1}_{i = k} A_{i} \\
&= (D_{M + k} - D_{k}) - k \times (C_{M + k} - C{k})
\end{align*}
$$

ã¨ãªã‚Šã¾ã™ã€‚å…¨ã¦ã®$k$ã«ã¤ã„ã¦è§£ã‚’æ±‚ã‚ãŸã¨ãã®æœ€å¤§å€¤ãŒç­”ãˆã¨ãªã‚Šã¾ã™ã€‚

### å®Ÿè£…ä¾‹

Pythonã«ã‚ˆã‚‹å®Ÿè£…ä¾‹ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚ç´¯ç©å’Œã¯`itertools.accumulate`ã‚’ç”¨ã„ã‚‹ã“ã¨ã§1è¡Œã§è¨˜è¿°ã§ãã¾ã™ã€‚

```python:c.py
from typing import *
import itertools


def main():
    # å…¥åŠ›å—ã‘å–ã‚Š
    N, M = map(int, input().split())
    A: List[int] = list(map(int, input().split()))

    # ç´¯ç©å’Œé…åˆ—ã®ä½œæˆ
    # å³åŠé–‹åŒºé–“[l, r)ã‚’æ‰±ã†ãŸã‚ã«å…ˆé ­ã«0ã‚’ä»˜ã‘åŠ ãˆã¦ã„ã‚‹
    C: List[int] = [0] + list(itertools.accumulate(A))
    D: List[int] = [0] + list(
        itertools.accumulate([(i + 1) * a for i, a in enumerate(A)])
    )

    # æ•´æ•°kã‚’å…¨æ¢ç´¢
    # ä»Šå›ã®å•é¡Œã§ã¯è² ã®æ•°ã‚’æ‰±ã†ã®ã§ã€è§£ã®åˆæœŸå€¤ã«ã¯ååˆ†å°ã•ã„è² ã®å€¤ã‚’å…¥ã‚Œã¦ãŠã
    answer: int = -(1 << 60)
    for k in range(N - M + 1):
        X: int = D[k + M] - D[k]
        Y: int = k * (C[k + M] - C[k])
        answer = max(answer, X - Y)

    # ç­”ãˆã®å‡ºåŠ›
    print(answer)

if __name__ == "__main__":
    main()
```

å®Ÿéš›ã®æå‡ºã¯[ã“ã¡ã‚‰](https://atcoder.jp/contests/abc267/submissions/34591851)ã€‚

[^1]:
    é•·ã•$N$ã®ç´¯ç©å’Œé…åˆ—$C$ã‚’ä½œã£ãŸã¨ãã€æ•´æ•°$l, r(0 \leq l < r < N)$ã«å¯¾ã—ã¦$C_r - C_l$ã¯å·¦åŠé–‹åŒºé–“$(l, r]$ã®åŒºé–“å’Œã¨ãªã‚Šã¾ã™ã€‚ç«¶ãƒ—ãƒ­ã®æ–‡è„ˆã ã¨å·¦åŠé–‹åŒºé–“ã‚’æ‰±ã†ã“ã¨ã¯ãã‚“ãªã«ç„¡ãã€ã‚€ã—ã‚å³åŠé–‹åŒºé–“$[l, r)$ã«é–¢å¿ƒãŒã‚ã‚‹ã“ã¨ãŒã»ã¨ã‚“ã©ã§ã™ã€‚å³åŠé–‹åŒºé–“$[l, r)$ã®åŒºé–“å’Œã‚’æ±‚ã‚ãŸã„ã¨ãã¯$C_{r - 1} - C_{l - 1}$ã¨ã™ã‚Œã°ã‚ˆã„ã§ã™ãŒã€æ·»å­—ãƒŸã‚¹ã§ãƒã‚°ã‚’ç”Ÿã¿ã‚„ã™ã„ã®ã§è‰¯ã„æ‰‹æ³•ã§ã¯ãªã„ã§ã™ã€‚
    ãã“ã§ã€å…ˆé ­ã«0ã‚’ä»˜ã‘åŠ ãˆãŸé•·ã•$N + 1$ã®ç´¯ç©å’Œé…åˆ—$C'$ã‚’ç”¨ã„ã‚‹ã¨ã€ä¸Šã¨åŒã˜æ•´æ•°$l, r$ã«ã¤ã„ã¦å³åŠé–‹åŒºé–“$[l, r)$ã®åŒºé–“å’Œã‚’$C'_{r} - C'_{l}$ã§æ±‚ã‚ã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã¡ã‚‰ã®æ–¹ãŒç°¡æ½”ã«è¨˜è¿°ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚(ã©ã®ã¿ã¡æ·»å­—ã®æ‰±ã„ã«ã¯æ³¨æ„ã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ãŒ)
